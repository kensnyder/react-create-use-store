{"version":3,"file":"index.umd.js","sources":["../src/createStore/createStore.js","../src/useStore/useStore.js"],"sourcesContent":["// an internal counter for stores\nlet storeIdx = 1;\n\n/**\n * Creates a new store\n * @param {Object} [config] - An object containing the store setup\n * @property {Object} [config.state] - The store's initial state. It can be of any type.\n * @property {Object} [config.actions] - Named functions that can be dispatched by name and payload.\n * @property {Boolean} [config.autoReset] - If true, reset the store when all consumer components unmount\n * @property {Function} [config.onFirstUse] - Callback the very first time a component calls useStore()\n * @property {Function} [config.afterFirstMount] - Callback when a useStore() component mounts when no other are mounted\n * @property {Function} [config.afterEachMount] - Callback every time a component first calls useStore()\n * @property {Function} [config.afterEachUnmount] - Callback when any useStore() component unmounts\n * @property {Function} [config.afterLastUnmount] - Callback when all user components unmount\n * @property {String} [config.id] - The id string for debugging\n * @return {Object} store - Info and methods for working with the store\n * @property {String} store.id - The id or number of the store\n * @property {Number} store.idx - The index order of the store in order of definition\n * @property {Function} store.addActions - Register more actions for this store\n * @property {Function} store.reset - Reset the store's state to its original value\n * @property {Object} store.actions - Methods that can be called to affect state\n * @property {Function} store._subscribe - A method to add a setState callback that should be notified on changes\n * @property {Function} store._unsubscribe - A method to remove a setState callback\n * @property {Number} store._usedCount - The number of components that have ever used this store\n */\nexport function createStore({\n  state = {},\n  actions = {},\n  autoReset = false,\n  onFirstUse = () => {},\n  afterFirstMount = () => {},\n  afterEachMount = () => {},\n  afterEachUnmount = () => {},\n  afterLastUnmount = () => {},\n  id = null,\n}) {\n  // list of setState functions for Components that use this store\n  let _setters = [];\n\n  // define the store object,\n  // which should normally not be consumed directly\n  const store = {\n    // A store's state can be reset to its original value\n    reset: () => _setAll(state),\n    // add more action functions to this state\n    addActions,\n    // the value represented\n    state: state,\n    // set the state and update all components that use this store\n    setState: _setAll,\n    // functions that receive [state, setState] as the first argument\n    // and act on state\n    actions: {},\n    // an identifier for debugging\n    id: String(id || `store-${storeIdx}`),\n    // internal counter\n    idx: storeIdx++,\n    // private: useStore() can subscribe to all store changes\n    _subscribe,\n    // private: useStore() can unsubscribe from changes\n    _unsubscribe,\n    // private: A count of the number of times this store has ever been used\n    _usedCount: 0,\n  };\n\n  // add any actions that are given at this time\n  addActions(actions);\n\n  // return this store\n  return store;\n\n  //\n  // functions only beyond this point\n  //\n\n  /**\n   * Add action functions to this state\n   * @param {Object} actions\n   */\n  function addActions(actions) {\n    // create dependency-injected versions of the given action functions\n    Object.keys(actions).forEach(name => {\n      const action = actions[name];\n      store.actions[name] = (...args) => {\n        action([state, _setAll], ...args);\n      };\n    });\n  }\n\n  /**\n   * Add a setState function to notify when state changes\n   * @param {Function} setState - Function returned from the useState() inside useStore()\n   * @private\n   */\n  function _subscribe(setState) {\n    if (store._usedCount++ === 0) {\n      onFirstUse(store);\n    }\n    if (_setters.length === 0) {\n      afterFirstMount(store);\n    }\n    if (_setters.indexOf(setState) === -1) {\n      _setters.push(setState);\n      afterEachMount(store);\n    }\n  }\n\n  /**\n   * Remove a setState function from notification when state changes\n   * @param {Function} setState - Function returned from the useState() inside useStore()\n   * @private\n   */\n  function _unsubscribe(setState) {\n    _setters = _setters.filter(setter => setter !== setState);\n    afterEachUnmount(store);\n    if (_setters.length === 0) {\n      if (autoReset) {\n        store.reset();\n      }\n      afterLastUnmount(store);\n    }\n  }\n\n  /**\n   * Notify each of the setState functions of the new state\n   * @param {*} newState\n   * @private\n   */\n  function _setAll(newState) {\n    if (typeof newState === 'function') {\n      newState = newState(store.state);\n    }\n    store.state = newState;\n    _setters.forEach(setter => setter(newState));\n  }\n}\n","import { useState, useEffect, useDebugValue } from 'react';\n\n/**\n * @param {Object} store - A store created with createStore()\n * @return {Object} - tools for working with the store\n * @property {*} state - The value in the store\n * @property {Object} actions - functions defined by createStore\n * @property {Function} reset - function to reset the store's state to its initial value\n */\nexport function useStore(store) {\n  const [, setState] = useState(store.state);\n\n  useDebugValue(store);\n\n  useEffect(() => {\n    store._subscribe(setState);\n    return () => store._unsubscribe(setState);\n  }, [store]);\n\n  return {\n    state: store.state,\n    actions: store.actions,\n    reset: store.reset,\n  };\n}\n"],"names":["let","storeIdx","_setters","store","reset","_setAll","state","addActions","setState","actions","id","String","idx","_usedCount","onFirstUse","length","afterFirstMount","indexOf","push","afterEachMount","filter","setter","afterEachUnmount","autoReset","afterLastUnmount","Object","keys","forEach","name","action","args","newState","useState","useDebugValue","useEffect","_subscribe","_unsubscribe"],"mappings":"4NACAA,IAAIC,EAAW,gBAwBR,yCACG,mCACE,sCACE,kSAMP,UAGDC,EAAW,GAITC,EAAQ,CAEZC,wBAAaC,EAAQC,eAErBC,EAEAD,MAAOA,EAEPE,SAAUH,EAGVI,QAAS,GAETC,GAAIC,OAAOD,YAAeT,GAE1BW,IAAKX,wBAsCaO,GACS,GAAvBL,EAAMU,cACRC,EAAWX,GAEW,IAApBD,EAASa,QACXC,EAAgBb,IAEkB,IAAhCD,EAASe,QAAQT,KACnBN,EAASgB,KAAKV,GACdW,EAAehB,2BASGK,GACpBN,EAAWA,EAASkB,gBAAOC,UAAUA,IAAWb,IAChDc,EAAiBnB,GACO,IAApBD,EAASa,SACPQ,GACFpB,EAAMC,QAERoB,EAAiBrB,KAzDnBU,WAAY,UAIdN,EAAWE,GAGJN,WAUEI,EAAWE,GAElBgB,OAAOC,KAAKjB,GAASkB,iBAAQC,OACrBC,EAASpB,EAAQmB,GACvBzB,EAAMM,QAAQmB,qEACZC,gBAAO,CAACvB,EAAOD,WAAayB,gBA4CzBzB,EAAQ0B,GACS,mBAAbA,IACTA,EAAWA,EAAS5B,EAAMG,QAE5BH,EAAMG,MAAQyB,EACd7B,EAASyB,iBAAQN,UAAUA,EAAOU,kBC5H/B,SAAkB5B,SACF6B,WAAS7B,EAAMG,iBAEpC2B,gBAAc9B,GAEd+B,8BACE/B,EAAMgC,WAAW3B,qBACJL,EAAMiC,aAAa5B,KAC/B,CAACL,IAEG,CACLG,MAAOH,EAAMG,MACbG,QAASN,EAAMM,QACfL,MAAOD,EAAMC"}